<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>Nouvelle √®re de tests E2E avec Playwright</title>
    <link rel="shortcut icon" href="./favicon.ico" />
    <link rel="stylesheet" href="./dist/reveal.css" />
    <link rel="stylesheet" href="./dist/theme/simple.css" id="theme" />
    <link rel="stylesheet" href="./css/highlight/zenburn.css" />

    <link rel="stylesheet" href="./_assets/style.css" />

  </head>
  <body>
    <div class="reveal">
      <div class="slides"><section  data-markdown><script type="text/template">
# Nouvelle √®re de tests E2E avec Playwright 

ü§ñ

</script></section><section  data-markdown><script type="text/template">

1. Intro
2. Webdriver vs DevsTools 
3. Playwright 
4. Features 
5. D√©mo 

</script></section><section ><section data-markdown><script type="text/template">
## Usecase

</script></section><section data-markdown><script type="text/template">
- Qualifier l'installation d'une application web
  - Tests de non regression
  - Tests acceptance
- Automatiser les "clicks button" sur les √©crans

</script></section></section><section ><section data-markdown><script type="text/template">
## Webdriver

</script></section><section data-markdown><script type="text/template">
![web driver architecture](attachments/playwright_webdriver.svg) 

* LE standard (W3C) <!-- .element: class="fragment" -->
* Cross Browser <!-- .element: class="fragment" -->

<aside class="notes"><p>Dans l&#39;achitecture classique, le client (node, java, autre) parle au navigateur par l&#39;interm√©diaire du webdriver.</p>
<p>Le webdriver interpr√®te les requ√™tes et se charge de l&#39;envoyer au navigateur.
C&#39;est √† ce jour le standard le plus repandu et utilis√© par de nombreux framework (cypress, fitness, robot)</p>
</aside></script></section><section data-markdown><script type="text/template">
Mais: 
- Client et Serveur peuvent se d√©synchroniser (‚ö†Ô∏ètiming / lenteurs)
- Limitations du webdriver vs le navigateur

_note perso: √©crire des tests selenium est une gal√®re..._

</script></section></section><section ><section data-markdown><script type="text/template">
## Devtools

</script></section><section data-markdown><script type="text/template">
![devtools architecture](attachments/playwright_devtools.svg) 

- Pas de middle man <!-- .element: class="fragment" -->
- Plus rapide et stable (?) <!-- .element: class="fragment" -->
- "Limit√©" par le protocol: g√©olocation, mobile, network interception, ... <!-- .element: class="fragment" -->

<aside class="notes"><p>tracing, audit, profiler ?</p>
</aside></script></section><section data-markdown><script type="text/template">
Mais:

- Pas "encore" un standard (CDP = Chrome Dev Tools)
  - Tous les navigateurs ne l'impl√©mente pas (ou pas de la m√™me fa√ßon)

</script></section></section><section ><section data-markdown><script type="text/template">
## Playwright
</script></section><section data-markdown><script type="text/template">
- 1.O.O en 2020
- D√©velopp√© par Microsoft : https://github.com/microsoft/playwright
  - Ancien √©quipe en charge de puppeteer <!-- .element: class="fragment" -->
- Multi-language <!-- .element: class="fragment" -->
  - typescript principalement <!-- .element: class="fragment" -->
  - java, python, .Net <!-- .element: class="fragment" -->
- Se base principalement sur le protocole DevTools <!-- .element: class="fragment" -->

</script></section><section data-markdown><script type="text/template">

- Gestion de sc√©narios avec multiples pages, domaines, iframe
- Auto-wait sur les √©l√©ments avant d'√©xecuter certaines actions (button, input)
- Interception des appels r√©seaux pour mocker les r√©sultats, voir r√©diriger 
- Emulation mobiles, geolocalisation, permissions

</script></section><section data-markdown><script type="text/template">
- Support de web components (shadow-dom compatible)
- Support du upload / dowload de fichier
- Screenshot, videos, tracing, recorder

</script></section></section><section ><section data-markdown><script type="text/template">

## Installation
</script></section><section data-markdown><script type="text/template">
```xml
 <dependency>
    <groupId>com.microsoft.playwright</groupId>
    <artifactId>playwright</artifactId>
    <version>${playwright.version}</version>
</dependency>
```

</script></section></section><section  data-markdown><script type="text/template">
## Examples / D√©mos

</script></section><section ><section data-markdown><script type="text/template">
CodeGen
```powershell
mvn exec:java -e "-Dexec.mainClass=com.microsoft.playwright.CLI" "-Dexec.args=codegen https://google.com"
```
- Ouvre un navigateur en mode priv√©
- Enregistre tout ce que fait l'utilisateur
- G√©n√®re le code correspondant üî•
</script></section><section data-markdown><script type="text/template">
![codegen](attachments/playwright_recorder.JPG) <!-- .element height="60%" width="60%" -->

</script></section></section><section ><section data-markdown><script type="text/template">
Debug
```java
try (Playwright playwright = Playwright.create()) {
    ...
  BrowserContext context = browser.newContext();
  
  // Open new page
  Page page = context.newPage();
  
  page.pause();
  
  // Go to https://www.google.com/
  page.navigate("https://www.google.com/");
}
```

</script></section><section data-markdown><script type="text/template">
```powershell
set PLAYWRIGHT_JAVA_SRC=<java src root>
set PWDEBUG=1
mvn test
```

</script></section><section data-markdown><script type="text/template">

![inspector](attachments/playwright_inspector.png) <!-- .element height="60%" width="60%" -->

</script></section></section><section  data-markdown><script type="text/template">
Network interception

```java 
// Mock network
page.route("**/api", route -> route.fulfill(
  new Route.FulfillOptions()
  .setStatus(200)
  .setBody("Hello World!")));

page.navigate("https://example.com/api");

assertTrue(page.content().contains("Hello World!"));
```

<aside class="notes"><p>Tr√®s utile pour</p>
<ul>
<li>Tracer/ logguer les appels entrant/sortant</li>
<li>Intercepter et simuler une r√©ponse</li>
<li>Cela peut aussi √©couter les websockets</li>
</ul>
</aside></script></section><section ><section data-markdown><script type="text/template">
## Tracing > Screenshot + Vid√©os

</script></section><section data-markdown><script type="text/template">

```java
page.screenshot(
        new Page.ScreenshotOptions()
                .setPath(Paths.get("screenshot.png")) 
                .setFullPage(true));
// ou
byte[] buffer = page.screenshot();
System.out.println(Base64.getEncoder().encode(buffer));
```

<aside class="notes"><p>On peut faire aussi un screenshot depuis un √©l√©ment en fournissant un selecteur</p>
</aside></script></section><section data-markdown><script type="text/template">

```java
context = browser.newContext(
        new Browser.NewContextOptions().
                    setRecordVideoDir(Paths.get("videos/")));
// Make sure to close, so that videos are saved.
context.close();
```

</script></section><section data-markdown><script type="text/template">

```java
Browser browser = browserType.launch();
BrowserContext context = browser.newContext();

// Start tracing before creating / navigating a page.
context.tracing().start(new Tracing.StartOptions()  
                    .setScreenshots(true)  
                    .setSnapshots(true));

Page page = context.newPage();
// Do some testing/navigating

// Stop tracing and export it into a zip archive.
context.tracing().stop( new Tracing.StopOptions()
        .setPath(Paths.get("trace.zip")));
```

<aside class="notes"><p><code>mvn exec:java -e &quot;-Dexec.mainClass=com.microsoft.playwright.CLI&quot; &quot;-Dexec.args=show-trace target/trace.zip&quot;</code></p>
</aside></script></section></section><section  data-markdown><script type="text/template">
# Reporting

- En cours (typescript seulement)
- Int√©gration avec Allure

</script></section><section  data-markdown><script type="text/template">
R√©f√©rences:

- Playwright:
  - Repo: https://github.com/microsoft/playwright
  - Docs: https://playwright.dev/java/

- Autres:
  - Slides: https://mikomatic.github.io/presentations/playwright.html#/
  - D√©mo: https://github.com/mikomatic/playwright-demo</script></section></div>
    </div>

    <script src="./dist/reveal.js"></script>

    <script src="./plugin/markdown/markdown.js"></script>
    <script src="./plugin/highlight/highlight.js"></script>
    <script src="./plugin/zoom/zoom.js"></script>
    <script src="./plugin/notes/notes.js"></script>
    <script src="./plugin/math/math.js"></script>
    <script>
      function extend() {
        var target = {};
        for (var i = 0; i < arguments.length; i++) {
          var source = arguments[i];
          for (var key in source) {
            if (source.hasOwnProperty(key)) {
              target[key] = source[key];
            }
          }
        }
        return target;
      }

      // default options to init reveal.js
      var defaultOptions = {
        controls: true,
        progress: true,
        history: true,
        center: true,
        transition: 'default', // none/fade/slide/convex/concave/zoom
        plugins: [
          RevealMarkdown,
          RevealHighlight,
          RevealZoom,
          RevealNotes,
          RevealMath
        ]
      };

      // options from URL query string
      var queryOptions = Reveal().getQueryHash() || {};

      var options = extend(defaultOptions, {"slideNumber":true}, queryOptions);
    </script>


    <script>
      Reveal.initialize(options);
    </script>
  </body>
</html>
